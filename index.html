<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Work Orders — Original Style</title>
<style>
  :root{--bg:#0b0d12;--panel:#0f1423;--card:#121726;--muted:#9db0c9;--text:#e8f0ff;--accent:#4da3ff;--border:#22314d}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .app{display:flex;flex-direction:column;height:100%}
  header{padding:12px 16px;border-bottom:1px solid var(--border);background:var(--panel);position:sticky;top:0;z-index:10}
  h1{margin:0;font-size:18px}
  .searchbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  input[type="search"]{flex:1;min-width:200px;padding:10px 12px;border-radius:8px;border:1px solid var(--border);background:#0b1322;color:var(--text);font-size:16px}
  
  .main{display:flex;flex:1;overflow:hidden}
  .list-pane{width:350px;border-right:1px solid var(--border);display:flex;flex-direction:column;background:var(--bg)}
  .list-content{flex:1;overflow-y:auto;padding:8px}
  .detail-pane{flex:1;overflow-y:auto;padding:20px;background:#06080a}

  /* List Items */
  .item{padding:12px;border-radius:10px;cursor:pointer;margin-bottom:6px;border:1px solid transparent;transition:all 0.2s}
  .item:hover{background:var(--panel)}
  .item.active{background:var(--accent);color:#fff}
  .item .addr{font-weight:600;font-size:15px}
  .item .sub{font-size:13px;opacity:0.8;margin-top:2px}

  /* Cards & Details */
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;max-width:800px;margin:0 auto;box-shadow:0 10px 30px rgba(0,0,0,0.5)}
  .section{margin-bottom:24px}
  .section h3{font-size:12px;text-transform:uppercase;letter-spacing:1px;color:var(--accent);margin:0 0 12px 0;border-bottom:1px solid var(--border);padding-bottom:8px}
  
  .parts-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(140px, 1fr));gap:8px}
  .part-item{background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:8px;display:flex;justify-content:space-between;font-size:13px}
  .part-val{font-weight:bold;color:var(--accent)}

  /* Mobile Overrides */
  @media(max-width:768px){
    .list-pane{width:100%; position:absolute; inset:0; z-index:5}
    .detail-pane{width:100%; position:absolute; inset:0; z-index:1}
    .app.mobile-detail .list-pane{display:none}
    .app.mobile-detail .detail-pane{z-index:10; display:block}
    
    /* Re-enabling the parts section on mobile */
    .section.parts { display: block !important; }
  }

  .back-btn{display:none; margin-bottom:15px; color:var(--accent); background:none; border:none; font-size:16px; font-weight:bold; cursor:pointer}
  @media(max-width:768px){ .back-btn{display:block} }
</style>
</head>
<body>

<div class="app" id="app">
  <header>
    <h1>Work Order Archive</h1>
    <div class="searchbar">
      <input type="search" id="q" placeholder="Search by address or WO#...">
    </div>
  </header>

  <div class="main">
    <div class="list-pane">
      <div id="meta" style="padding:10px; font-size:12px; color:var(--muted)"></div>
      <div id="list" class="list-content"></div>
    </div>
    <div class="detail-pane" id="detailPane">
      <button class="back-btn" onclick="goBack()">← Back to List</button>
      <div id="detail"></div>
    </div>
  </div>
</div>

<script>
  let records = [];
  const listEl = document.getElementById('list');
  const detailEl = document.getElementById('detail');
  const app = document.getElementById('app');

  fetch('data.json').then(r => r.json()).then(data => {
    records = data.records || [];
    render();
  });

  function render() {
    const term = document.getElementById('q').value.toLowerCase();
    const filtered = records.filter(r => 
      (r.ADDRESS && r.ADDRESS.toLowerCase().includes(term)) || 
      (r['WORK_ORDER NO'] && r['WORK_ORDER NO'].toString().includes(term))
    );

    document.getElementById('meta').textContent = `${filtered.length} Records Found`;
    
    listEl.innerHTML = filtered.map((r, i) => `
      <div class="item" onclick="showDetail(${records.indexOf(r)})">
        <div class="addr">${r.ADDRESS || 'No Address'}</div>
        <div class="sub">WO #${r['WORK_ORDER NO']} • ${r.DATE ? r.DATE.split(' ')[0] : ''}</div>
      </div>
    `).join('');
  }

  function showDetail(idx) {
    const r = records[idx];
    app.classList.add('mobile-detail');
    
    // Function to check if a value is valid (Not empty, 0, or N/A)
    const isVal = v => v && v !== "0" && v !== "" && v !== "N/A" && v !== "NaT";

    // Build Parts Groups
    const buildParts = (prefix, label) => {
      let items = '';
      for(let i=1; i<=8; i++) {
        let v = r[prefix + i];
        if(isVal(v)) items += `<div class="part-item"><span>Part ${prefix}${i}</span><span class="part-val">${v}</span></div>`;
      }
      return items ? `<div class="section"><h3>${label}</h3><div class="parts-grid">${items}</div></div>` : '';
    };

    // Build Misc
    let misc = '';
    for(let i=1; i<=9; i++) {
      let qty = r['MISC'+i];
      let name = r['MISC'+i+'A'];
      if(isVal(qty) || isVal(name)) {
        misc += `<div class="part-item"><span>${name || 'Misc'}</span><span class="part-val">${qty || ''}</span></div>`;
      }
    }
    const miscBlock = misc ? `<div class="section"><h3>Miscellaneous</h3><div class="parts-grid">${misc}</div></div>` : '';

    detailEl.innerHTML = `
      <div class="card">
        <h2 style="margin:0 0 10px 0; color:var(--accent)">${r.ADDRESS}</h2>
        <div style="margin-bottom:20px; font-size:14px; color:var(--muted)">
          ${isVal(r.DATE) ? 'Date: ' + r.DATE.split(' ')[0] : ''} 
          ${isVal(r['WORK_ORDER NO']) ? ' | WO: #' + r['WORK_ORDER NO'] : ''}
        </div>

        ${isVal(r.PROBLEM) ? `<div class="section"><h3>Problem</h3><p>${r.PROBLEM}</p></div>` : ''}
        ${isVal(r.NOTES) ? `<div class="section"><h3>Notes</h3><p>${r.NOTES}</p></div>` : ''}
        
        <div class="section parts">
          ${buildParts('A', '1" Parts')}
          ${buildParts('B', '1.25" Parts')}
          ${buildParts('C', '1.5" Parts')}
          ${buildParts('D', '2" / 2.5" Parts')}
          ${buildParts('E', 'Large Parts')}
          ${miscBlock}
        </div>
      </div>
    `;
    document.getElementById('detailPane').scrollTop = 0;
  }

  function goBack() { app.classList.remove('mobile-detail'); }
  document.getElementById('q').addEventListener('input', render);
</script>
</body>
</html>